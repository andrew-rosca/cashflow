<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Bulk balance update â€“ prototype</title>
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: ui-sans-serif, system-ui, sans-serif;
      background: #f9fafb;
      color: #111827;
      padding: 2rem;
      margin: 0;
    }
    .panel {
      width: 20rem;
      border: 1px solid #e5e7eb;
      border-radius: 0.5rem;
      padding: 1rem;
      background: #fff;
    }
    .panel-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 0.75rem;
      min-width: 0;
    }
    .panel-title {
      font-size: 0.875rem;
      font-weight: 500;
      color: #6b7280;
      text-transform: uppercase;
      letter-spacing: 0.025em;
      margin: 0;
    }
    .btn-group {
      display: flex;
      align-items: center;
      gap: 0.25rem;
    }
    .btn-round {
      width: 1.25rem;
      height: 1.25rem;
      border-radius: 9999px;
      border: 1px solid #d1d5db;
      background: transparent;
      color: #9ca3af;
      font-size: 0.75rem;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 0;
      line-height: 1;
    }
    .btn-round:hover {
      color: #4b5563;
      border-color: #9ca3af;
    }
    .btn-text {
      font-size: 0.75rem;
      padding: 0.25rem 0.5rem;
      border-radius: 0.25rem;
      border: 1px solid #d1d5db;
      background: #fff;
      color: #4b5563;
      cursor: pointer;
      margin-left: 0.25rem;
    }
    .btn-text:hover {
      background: #f3f4f6;
      border-color: #9ca3af;
    }
    .account-row {
      display: grid;
      grid-template-columns: minmax(5rem, 1fr) auto auto;
      align-items: center;
      gap: 0.5rem;
      padding: 0.25rem 0.5rem;
      margin: 0 -0.5rem;
      border-radius: 0.25rem;
    }
    .account-row:hover {
      background: #f9fafb;
    }
    .account-name {
      font-size: 0.75rem;
      color: #6b7280;
      min-width: 5rem;
    }
    .account-date {
      font-size: 0.875rem;
      color: #111827;
    }
    .account-balance {
      font-size: 0.875rem;
      font-family: ui-monospace, monospace;
      color: #111827;
      text-align: right;
    }
    .overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.4);
      align-items: center;
      justify-content: center;
      z-index: 50;
    }
    .overlay.open {
      display: flex;
    }
    .dialog {
      background: #fff;
      border-radius: 0.5rem;
      border: 1px solid #e5e7eb;
      padding: 1.5rem;
      min-width: 20rem;
      max-width: 90vw;
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
    }
    .dialog-title {
      font-size: 1rem;
      font-weight: 600;
      color: #111827;
      margin: 0 0 0.25rem 0;
    }
    .dialog-date {
      font-size: 0.875rem;
      color: #6b7280;
      margin-bottom: 1rem;
    }
    .dialog-rows {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
      margin-bottom: 1.25rem;
    }
    .dialog-row {
      display: grid;
      grid-template-columns: minmax(6rem, 1fr) 6rem;
      align-items: center;
      gap: 0.75rem;
    }
    .dialog-row label {
      font-size: 0.875rem;
      color: #374151;
    }
    .dialog-row input {
      font-size: 0.875rem;
      font-family: ui-monospace, monospace;
      padding: 0.375rem 0.5rem;
      border: 1px solid #d1d5db;
      border-radius: 0.25rem;
      text-align: right;
    }
    .dialog-row input:focus {
      outline: none;
      border-color: #3b82f6;
      box-shadow: 0 0 0 1px #3b82f6;
    }
    .dialog-actions {
      display: flex;
      justify-content: flex-end;
      gap: 0.5rem;
    }
    .btn-primary {
      font-size: 0.875rem;
      padding: 0.375rem 0.75rem;
      border-radius: 0.25rem;
      border: none;
      background: #3b82f6;
      color: #fff;
      cursor: pointer;
    }
    .btn-primary:hover {
      background: #2563eb;
    }
    .btn-secondary {
      font-size: 0.875rem;
      padding: 0.375rem 0.75rem;
      border-radius: 0.25rem;
      border: 1px solid #d1d5db;
      background: #fff;
      color: #374151;
      cursor: pointer;
    }
    .btn-secondary:hover {
      background: #f3f4f6;
    }
  </style>
</head>
<body>
  <div class="panel">
    <div class="panel-header">
      <h2 class="panel-title">Current Balances</h2>
      <div class="btn-group">
        <button type="button" class="btn-round" title="Add account">+</button>
        <button type="button" class="btn-text" id="btn-update-all">Update all</button>
      </div>
    </div>
    <div class="space-y-1" id="account-list">
      <!-- Filled by JS -->
    </div>
  </div>

  <div class="overlay" id="dialog-overlay" aria-hidden="true">
    <div class="dialog" role="dialog" aria-labelledby="dialog-title" aria-modal="true">
      <h3 class="dialog-title" id="dialog-title">Update all balances</h3>
      <p class="dialog-date" id="dialog-date">As of Jan 31</p>
      <div class="dialog-rows" id="dialog-rows">
        <!-- Filled by JS -->
      </div>
      <div class="dialog-actions">
        <button type="button" class="btn-secondary" id="btn-cancel">Cancel</button>
        <button type="button" class="btn-primary" id="btn-save">Save</button>
      </div>
    </div>
  </div>

  <script>
    (function () {
      const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];

      function formatDate(date) {
        return monthNames[date.getMonth()] + ' ' + date.getDate();
      }

      function formatNumber(n) {
        return Number(n).toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
      }

      function todayString() {
        const d = new Date();
        const y = d.getFullYear();
        const m = String(d.getMonth() + 1).padStart(2, '0');
        const day = String(d.getDate()).padStart(2, '0');
        return y + '-' + m + '-' + day;
      }

      let accounts = [
        { id: '1', name: 'Account 1', balanceAsOf: '2025-01-10', initialBalance: 9445 },
        { id: '2', name: 'Account 2', balanceAsOf: '2025-01-10', initialBalance: 1480 },
        { id: '3', name: 'Account 3', balanceAsOf: '2025-01-10', initialBalance: 2178 },
      ];

      function renderList() {
        const el = document.getElementById('account-list');
        el.innerHTML = accounts.map(function (a) {
          const dateStr = a.balanceAsOf ? a.balanceAsOf.split('T')[0] : todayString();
          const d = new Date(dateStr + 'T12:00:00');
          const dateLabel = formatDate(d);
          const balanceLabel = formatNumber(a.initialBalance);
          return (
            '<div class="account-row">' +
            '<span class="account-name">' + escapeHtml(a.name) + '</span>' +
            '<span class="account-date">' + escapeHtml(dateLabel) + '</span>' +
            '<span class="account-balance">' + escapeHtml(balanceLabel) + '</span>' +
            '</div>'
          );
        }).join('');
      }

      function escapeHtml(s) {
        const div = document.createElement('div');
        div.textContent = s;
        return div.innerHTML;
      }

      const overlay = document.getElementById('dialog-overlay');
      const dialog = overlay.querySelector('.dialog');
      const dialogDateEl = document.getElementById('dialog-date');
      const dialogRowsEl = document.getElementById('dialog-rows');
      const btnUpdateAll = document.getElementById('btn-update-all');
      const btnCancel = document.getElementById('btn-cancel');
      const btnSave = document.getElementById('btn-save');

      function getDialogFocusables() {
        if (!dialog) return [];
        var inputs = Array.prototype.slice.call(dialogRowsEl.querySelectorAll('input:not([disabled])'));
        return inputs.concat([btnSave, btnCancel]);
      }

      function handleDialogTab(e) {
        if (!overlay.classList.contains('open') || e.key !== 'Tab') return;
        var focusables = getDialogFocusables();
        if (focusables.length === 0) return;
        var idx = focusables.indexOf(document.activeElement);
        if (idx === -1) return;
        e.preventDefault();
        if (e.shiftKey) {
          idx = (idx - 1 + focusables.length) % focusables.length;
        } else {
          idx = (idx + 1) % focusables.length;
        }
        focusables[idx].focus();
      }

      function openDialog() {
        const today = new Date();
        dialogDateEl.textContent = 'As of ' + formatDate(today);

        dialogRowsEl.innerHTML = accounts.map(function (a) {
          const id = 'balance-' + a.id;
          const value = String(a.initialBalance);
          return (
            '<div class="dialog-row">' +
            '<label for="' + id + '">' + escapeHtml(a.name) + '</label>' +
            '<input type="text" id="' + id + '" data-account-id="' + escapeHtml(a.id) + '" value="' + escapeHtml(value) + '">' +
            '</div>'
          );
        }).join('');

        overlay.classList.add('open');
        overlay.setAttribute('aria-hidden', 'false');

        var firstInput = dialogRowsEl.querySelector('input');
        if (firstInput) {
          setTimeout(function () {
            firstInput.focus();
            firstInput.select();
          }, 0);
        }
      }

      function closeDialog() {
        overlay.classList.remove('open');
        overlay.setAttribute('aria-hidden', 'true');
      }

      function saveDialog() {
        const today = todayString();
        accounts.forEach(function (a) {
          const input = document.getElementById('balance-' + a.id);
          if (input) {
            const val = parseFloat(input.value);
            a.initialBalance = isNaN(val) ? 0 : val;
            a.balanceAsOf = today;
          }
        });
        renderList();
        closeDialog();
      }

      btnUpdateAll.addEventListener('click', openDialog);
      btnCancel.addEventListener('click', closeDialog);
      btnSave.addEventListener('click', saveDialog);

      overlay.addEventListener('click', function (e) {
        if (e.target === overlay) closeDialog();
      });

      dialog.addEventListener('focusin', function (e) {
        if (dialogRowsEl.contains(e.target) && e.target.tagName === 'INPUT') {
          e.target.select();
        }
      });

      document.addEventListener('keydown', function (e) {
        if (e.key === 'Escape' && overlay.classList.contains('open')) {
          closeDialog();
        }
        handleDialogTab(e);
      });

      renderList();
    })();
  </script>
</body>
</html>
